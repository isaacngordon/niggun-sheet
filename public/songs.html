<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niggun Sheet | Songs List</title>
    <link rel="stylesheet" href="css/main.css">
<style>
    #sheet-tab {
        position: fixed;
        right: 0;
        top: 20%;
        transform: translateY(-20%);
        background-color: #FFD700; /* Assuming #FFD700 is the yellow color being reused */
        color: black;
        padding: 10px;
        cursor: pointer;
        z-index: 1000;
    }

    #sheet-container.open {
        right: 0;
        color: black; /* Ensure text color is black when the tab is open */
    }

    #sheet-container {
        position: fixed;
        right: -300px;
        top: 0;
        width: 300px;
        height: 100%;
        background-color: white;
        box-shadow: -2px 0 5px rgba(0,0,0,0.5);
        transition: right 0.3s ease;
        z-index: 999;
        overflow-y: auto;
    }

    #sheet-container.open {
        right: 0;
    }

    #sheet-container h2 {
        text-align: center;
    }

    #sheet-container ul {
        list-style-type: none;
        padding: 0;
    }

    #sheet-container ul li {
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }
</style>
<body>
        <!-- Modern responsive header with your logo -->
<!-- Modern responsive header with your logo repositioned -->
<!-- Modern responsive header with updated color scheme -->
<!-- Modern responsive header with logo at far left -->
<header class="bg-gray-900 sticky top-0 z-50">
    <div class="relative z-50 flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8">
      <!-- Logo positioned at far left -->
      <div class="flex items-center">
        <a href="/" class="mr-8">
          <img src="/assets/Niggun_Sheet_Header_Logo.png" alt="Niggun Sheet" class="h-10" />
        </a>
      </div>
      
      <!-- Mobile menu button (only visible on mobile) -->
      <div class="flex lg:hidden ml-auto">
        <button type="button" class="block text-white" id="mobile-menu-button">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="24" height="24">
            <path fill="currentColor" d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path>
          </svg>
        </button>
      </div>
      
      <!-- Desktop Navigation (now positioned after logo) -->
      <div class="hidden lg:flex lg:items-center lg:flex-1 lg:justify-center">
        <ul class="flex h-full items-center gap-8">
          <a class="flex items-center px-3 py-3 text-base font-normal text-header-link hover:text-white whitespace-nowrap" href="/">Home</a>
          <a class="flex items-center px-3 py-3 text-base font-normal text-header-link hover:text-white whitespace-nowrap" href="/songs.html">Song Directory</a>
          <a class="flex items-center px-3 py-3 text-base font-normal text-header-link hover:text-white whitespace-nowrap" href="/sheet-builder.html">Sheet Builder
            <span class="ml-2.5 rounded-sm bg-yellow-400 p-1 text-xs font-bold uppercase leading-none text-gray-900">new</span>
          </a>
          <a class="flex items-center px-3 py-3 text-base font-normal text-header-link hover:text-white whitespace-nowrap" href="/contact.html">Contact</a>
        </ul>
      </div>
      
      <!-- User Action Buttons -->
      <div class="flex h-full min-h-8 shrink-0 items-center justify-end">
        <button type="button" class="flex justify-center items-center font-bold rounded-full transition-colors bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-1.5 px-5 text-sm">
          <span class="relative flex min-h-5 items-center justify-center">
            <span class="whitespace-nowrap">Download Sheet</span>
          </span>
        </button>
      </div>
    </div>
    
    <!-- Mobile Menu (hidden by default) -->
    <div id="mobile-menu" class="hidden lg:hidden">
      <div class="space-y-1 px-4 pb-3 pt-2">
        <a href="/" class="block px-3 py-2 text-base font-medium text-header-link hover:text-white">Home</a>
        <a href="/songs.html" class="block px-3 py-2 text-base font-medium text-header-link hover:text-white">Song Directory</a>
        <a href="/sheet-builder.html" class="block px-3 py-2 text-base font-medium text-header-link hover:text-white">Sheet Builder <span class="ml-2 rounded-sm bg-yellow-400 p-1 text-xs font-bold uppercase leading-none text-gray-900">new</span></a>
        <a href="/contact.html" class="block px-3 py-2 text-base font-medium text-header-link hover:text-white">Contact</a>
      </div>
    </div>
  </header>

    <div id="songs-table">
        <div style="display: flex; flex-direction: column; justify-content: space-between; align-items: center;">
            <h2>All Niggunim</h2>
            <div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%;">
                <button id="clear-sheet" disabled>Clear Sheet</button>
                <div id="smartboard-toggle">
                    <label for="smartboard-mode">Smartboard Mode</label>
                    <input type="checkbox" id="smartboard-mode">
                    <script>
                        document.getElementById("smartboard-mode").checked = localStorage.getItem("smartboardMode") === "true";
                    </script>
                </div>
            </div>
        </div>
        
        <input type="search" id="song-search" placeholder="Search..." onkeydown="if(event.key === 'Enter') performSearch()">
        <button id="search-button" onclick="performSearch()">Search</button>
        <button id="clear-search-button" onclick="clearSearch()">Clear Search</button>
        <table>
            <thead>
                <tr>
                    <th>Search Title</th>
                    <th style="display:none;">Title</th>
                    <th style="display:none;">Artist</th>
                    <th style="display:none;">Lyrics</th>
                    <th style="display:none;">Google Drive</th>
                    <th style="display:none;">YouTube</th>
                    <th style="display:none;">Spotify</th>
                    <th>Action</th> 
                </tr>
            </thead>
            <tbody id="songs-table-body">
                <!-- Songs will be dynamically populated here -->
            </tbody>
        </table>
    </div>

    <div id="sheet-tab">View Selected Songs</div>
    <div id="sheet-container">
        <h2>Selected Songs</h2>
        <ul id="sheet-songs-list">
            <!-- Selected songs will be dynamically populated here -->
        </ul>
    </div>

    <div id="footer">
        <a href="https://drive.google.com/file/d/1X_aY7tb7E9RxKVyXDYkGAC_wMGznGJe6/view?usp=drive_link" target="_blank">Download Niggun Sheet</a>
        <a href="https://drive.google.com/file/d/1GrpBue_ukxtR7mKjuGZljXL_X-I7Y4wu/view?usp=drive_link" target="_blank">Download Simcha Sheet</a>
        <div class="footer-copyright">Â© 2025 Yehudah Jacobs - The Niggun Sheet</div>
    </div>

    <script>
        const songsEndpoint = "/api/songs";
        const songsTableBody = document.getElementById("songs-table-body");
        let sheetSongs = JSON.parse(localStorage.getItem("sheetSongs")) || [];
        const smartboardModeSwitch = document.getElementById("smartboard-mode");

        function addToSheet(song_title, song_artist, button) {
            let sheetSongs = JSON.parse(localStorage.getItem("sheetSongs")) || [];
            if (!sheetSongs.some(s => s.title === song_title && s.artist === song_artist)) {
                let song_lyrics = button.getAttribute("data-lyrics");
                sheetSongs.push({title: song_title, artist: song_artist, lyrics: decodeURIComponent(song_lyrics)});
                localStorage.setItem("sheetSongs", JSON.stringify(sheetSongs));
                alert(`${song_title} added to the sheet.`);
                button.textContent = "Remove from Sheet";
                button.onclick = () => removeFromSheet(song_title, song_artist, button);
                updateClearSheetButton();
                renderSheetSongs();
                return;
            }
            alert(`${song_title} is already in the sheet.`);
            // Reload the page without search query
            window.location.href = window.location.pathname;
        }

        function removeFromSheet(song_title, song_artist, button) {
            let sheetSongs = JSON.parse(localStorage.getItem("sheetSongs")) || [];
            sheetSongs = sheetSongs.filter(s => !(s.title === song_title && s.artist === song_artist));
            localStorage.setItem("sheetSongs", JSON.stringify(sheetSongs));
            alert(`${song_title} removed from the sheet.`);
            button.textContent = "Add to Sheet";
            button.onclick = () => addToSheet(song_title, song_artist, button);
            updateClearSheetButton();
            renderSheetSongs();
        }

        function renderSongs(songs) {
            sheetSongs = JSON.parse(localStorage.getItem("sheetSongs")) || [];
            songsTableBody.innerHTML = "";
            songs.forEach(song => {
                const songRow = document.createElement("tr");
                songRow.classList.add("data-row");

                let queryString = `?title=${encodeURIComponent(song.title)}&artist=${encodeURIComponent(song.artist)}&lyrics=${encodeURIComponent(song.lyrics)}&drive=${encodeURIComponent(song.drive)}&youtube=${encodeURIComponent(song.youtube)}&spotify=${encodeURIComponent(song.spotify)}`;
                let dynamicPageLink = smartboardModeSwitch.checked ?
                    `/smartboard-mode.html${queryString}` :
                    `/song-details.html${queryString}`;

                songRow.innerHTML = `
                    <td class="search-title"><a href="${dynamicPageLink}">${song.search_title}</a></td>
                    <td style="display:none;">${song.title}</td>
                    <td style="display:none;">${song.artist}</td>
                    <td style="display:none;">${song.lyrics}</td>
                    <td style="display:none;"><a href="${song.drive}" target="_blank">Google Drive</a></td>
                    <td style="display:none;"><a href="${song.youtube}" target="_blank">YouTube</a></td>
                    <td style="display:none;"><a href="${song.spotify}" target="_blank">Spotify</a></td>
                    <td>
                        <button data-lyrics="${encodeURIComponent(song.lyrics)}" onclick='${sheetSongs.some(s => s.title === song.title && s.artist === song.artist) ? `removeFromSheet("${song.title}", "${song.artist}", this)` : `addToSheet("${song.title}", "${song.artist}", this)`}'>
                            ${sheetSongs.some(s => s.title === song.title && s.artist === song.artist) ? "Remove from Sheet" : "Add to Sheet"}
                        </button>
                    </td>
                `;
                songsTableBody.appendChild(songRow);
            });
        }

        // Function to get query parameter by name
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Populate search box and filter results based on query parameter
        const initialSearchQuery = getQueryParam('search') || '';
        document.getElementById('song-search').value = initialSearchQuery;

        fetch(songsEndpoint)
            .then(response => response.json())
            .then(data => {
                if (initialSearchQuery) {
                    const filteredResults = data.filter(song =>
                        song.title.toLowerCase().includes(initialSearchQuery.toLowerCase()) || 
                        song.artist.toLowerCase().includes(initialSearchQuery.toLowerCase())
                    );
                    renderSongs(filteredResults);
                } else {
                    renderSongs(data);
                }
            })
            .catch(error => {
                console.error('Error loading songs:', error);
                songsTableBody.innerText = "Error loading songs.";
            });

        function performSearch() {
            const query = document.getElementById("song-search").value.toLowerCase();
            const searchTitleCells = document.querySelectorAll(".search-title");
            searchTitleCells.forEach(cell => {
                const row = cell.parentNode;
                if (cell.textContent.toLowerCase().includes(query)) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }

        function clearSearch() {
            document.getElementById("song-search").value = '';
            // Reload the page without search query
            window.location.href = window.location.pathname;
        }

        smartboardModeSwitch.addEventListener("change", function () {
            localStorage.setItem("smartboardMode", this.checked);

            fetch(songsEndpoint)
                .then(response => response.json())
                .then(data => {
                    renderSongs(data);
                })
                .catch(error => {
                    console.error('Error loading songs:', error);
                    songsTableBody.innerText = "Error loading songs.";
                });
        });
        function updateClearSheetButton() {
            const clearSheetButton = document.getElementById("clear-sheet");
            const sheetSongs = JSON.parse(localStorage.getItem("sheetSongs")) || [];
            clearSheetButton.disabled = sheetSongs.length === 0;
        }

        document.getElementById("clear-sheet").addEventListener("click", function () {
            if (confirm("Are you sure you want to clear the sheet?")) {
                localStorage.removeItem("sheetSongs");
                updateClearSheetButton();
                alert("Sheet cleared.");

                // reload the page to update the sheet
                location.reload();
            }
        });

        // Initial button state update
        updateClearSheetButton();

        // Function to render the selected songs in the sheet
        function renderSheetSongs() {
            const sheetSongsList = document.getElementById("sheet-songs-list");
            const sheetSongs = JSON.parse(localStorage.getItem("sheetSongs")) || [];
            sheetSongsList.innerHTML = "";
            sheetSongs.forEach(song => {
                const songItem = document.createElement("li");
                songItem.textContent = `${song.title}`;
                sheetSongsList.appendChild(songItem);
            });
        }

        // Event listener for the sheet tab
        document.getElementById("sheet-tab").addEventListener("click", function () {
            const sheetContainer = document.getElementById("sheet-container");
            sheetContainer.classList.toggle("open");
            if (sheetContainer.classList.contains("open")) {
                this.textContent = "Close";
            } else {
                this.textContent = "View Selected Songs";
            }
            renderSheetSongs();
        });
    </script>
</body>
</html>
